'use client'

import { motion } from 'framer-motion'
import { useState, useEffect } from 'react'
import DetailPageLayout from '@/components/DetailPageLayout'
import CodeBlock from '@/components/CodeBlock'
import Callout from '@/components/Callout'

export default function KernelExploitationPost() {
  const [activeSection, setActiveSection] = useState('')

  useEffect(() => {
    const handleScroll = () => {
      const sections = ['introduction', 'kernel-basics', 'vulnerability-types', 'exploitation-techniques', 'privilege-escalation', 'defensive-measures', 'key-takeaways']
      
      for (const section of sections) {
        const element = document.getElementById(section)
        if (element) {
          const rect = element.getBoundingClientRect()
          if (rect.top <= 100 && rect.bottom >= 100) {
            setActiveSection(section)
            break
          }
        }
      }
    }

    window.addEventListener('scroll', handleScroll)
    return () => window.removeEventListener('scroll', handleScroll)
  }, [])

  const tocSections = [
    { id: 'introduction', title: 'Introduction' },
    { id: 'kernel-basics', title: 'Kernel Basics' },
    { id: 'vulnerability-types', title: 'Vulnerability Types' },
    { id: 'exploitation-techniques', title: 'Exploitation Techniques' },
    { id: 'privilege-escalation', title: 'Privilege Escalation' },
    { id: 'defensive-measures', title: 'Defensive Measures' },
    { id: 'key-takeaways', title: 'Key Takeaways' }
  ]

  const kernelBasicsCode = `// Understanding Kernel Space vs User Space
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/syscalls.h>
#include <linux/uaccess.h>

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Darrius Grate");
MODULE_DESCRIPTION("Kernel Exploitation Basics");

// Kernel space has direct hardware access
static int kernel_function(void) {
    // Direct memory access
    void *kernel_addr = (void *)0xffffffff80000000;
    
    // Direct hardware access
    outb(0x43, 0x43); // Write to I/O port
    
    // No memory protection
    *(int *)kernel_addr = 0xdeadbeef;
    
    return 0;
}

// System call interface
asmlinkage long sys_custom_call(unsigned long user_addr, size_t len) {
    char kernel_buffer[256];
    
    // Copy from user space to kernel space
    if (copy_from_user(kernel_buffer, (void *)user_addr, len)) {
        return -EFAULT;
    }
    
    // Process in kernel space
    kernel_function();
    
    // Copy back to user space
    if (copy_to_user((void *)user_addr, kernel_buffer, len)) {
        return -EFAULT;
    }
    
    return 0;
}

// Memory management in kernel
static void kernel_memory_management(void) {
    // Allocate kernel memory
    void *ptr = kmalloc(1024, GFP_KERNEL);
    if (!ptr) {
        printk(KERN_ERR "Memory allocation failed\\n");
        return;
    }
    
    // Use memory
    memset(ptr, 0, 1024);
    
    // Free memory
    kfree(ptr);
}

// Interrupt handling
static irqreturn_t interrupt_handler(int irq, void *dev_id) {
    // Handle hardware interrupt
    printk(KERN_INFO "Interrupt %d received\\n", irq);
    
    // Acknowledge interrupt
    return IRQ_HANDLED;
}`

  const vulnerabilityTypesCode = `// Common Kernel Vulnerability Types
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/fs.h>
#include <linux/uaccess.h>

// 1. Buffer Overflow
static int vulnerable_read(struct file *file, char __user *buf, size_t count, loff_t *ppos) {
    char kernel_buffer[64];
    
    // VULNERABLE: No bounds checking
    if (copy_from_user(kernel_buffer, buf, count)) {
        return -EFAULT;
    }
    
    // Potential buffer overflow if count > 64
    return count;
}

// 2. Use-After-Free
static struct device *global_device = NULL;

static int device_open(struct inode *inode, struct file *file) {
    global_device = kmalloc(sizeof(struct device), GFP_KERNEL);
    if (!global_device) return -ENOMEM;
    
    return 0;
}

static int device_release(struct inode *inode, struct file *file) {
    // VULNERABLE: Free but don't null pointer
    kfree(global_device);
    // global_device = NULL; // Missing!
    
    return 0;
}

static int device_ioctl(struct file *file, unsigned int cmd, unsigned long arg) {
    // VULNERABLE: Use after free
    if (global_device) {
        global_device->data = arg; // Use after free!
    }
    
    return 0;
}

// 3. Integer Overflow
static int vulnerable_calc(size_t size, size_t count) {
    // VULNERABLE: Integer overflow
    size_t total = size * count;
    
    if (total < size) {
        // Overflow occurred
        return -EINVAL;
    }
    
    // Allocate memory
    void *ptr = kmalloc(total, GFP_KERNEL);
    if (!ptr) return -ENOMEM;
    
    kfree(ptr);
    return 0;
}

// 4. Race Condition
static int shared_counter = 0;
static DEFINE_SPINLOCK(counter_lock);

static int race_condition_read(struct file *file, char __user *buf, size_t count, loff_t *ppos) {
    int local_counter;
    
    // VULNERABLE: Race condition without proper locking
    local_counter = shared_counter;
    shared_counter++;
    
    // Copy to user space
    if (copy_to_user(buf, &local_counter, sizeof(local_counter))) {
        return -EFAULT;
    }
    
    return sizeof(local_counter);
}

// 5. Double Free
static void *freed_ptr = NULL;

static int double_free_alloc(size_t size) {
    freed_ptr = kmalloc(size, GFP_KERNEL);
    if (!freed_ptr) return -ENOMEM;
    
    return 0;
}

static int double_free_free(void) {
    if (freed_ptr) {
        kfree(freed_ptr);
        // VULNERABLE: Don't null the pointer
        // freed_ptr = NULL;
    }
    
    return 0;
}

static int double_free_vulnerable(void) {
    // First free
    double_free_free();
    
    // Second free - double free vulnerability!
    double_free_free();
    
    return 0;
}`

  const exploitationTechniquesCode = `// Kernel Exploitation Techniques
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/slab.h>
#include <linux/uaccess.h>

// 1. ROP (Return-Oriented Programming) in Kernel
static unsigned long rop_gadgets[] = {
    0xffffffff81000000, // pop rdi; ret
    0xffffffff81000010, // pop rsi; ret
    0xffffffff81000020, // pop rdx; ret
    0xffffffff81000030, // mov rax, rdi; ret
    0xffffffff81000040, // syscall; ret
};

static void kernel_rop_exploit(void) {
    unsigned long *rop_chain = kmalloc(64 * sizeof(unsigned long), GFP_KERNEL);
    if (!rop_chain) return;
    
    // Build ROP chain
    rop_chain[0] = rop_gadgets[0]; // pop rdi; ret
    rop_chain[1] = 0x1;            // rdi = 1 (stdout)
    rop_chain[2] = rop_gadgets[1]; // pop rsi; ret
    rop_chain[3] = (unsigned long)"Hello from kernel!\\n";
    rop_chain[4] = rop_gadgets[2]; // pop rdx; ret
    rop_chain[5] = 20;             // rdx = 20 (length)
    rop_chain[6] = rop_gadgets[3]; // mov rax, rdi; ret
    rop_chain[7] = 1;              // rax = 1 (write syscall)
    rop_chain[8] = rop_gadgets[4]; // syscall; ret
    
    // Execute ROP chain (simplified)
    // In real exploit, this would be triggered by vulnerability
    kfree(rop_chain);
}

// 2. Heap Spraying
static void kernel_heap_spray(void) {
    void *spray_chunks[1000];
    int i;
    
    // Allocate many chunks to control heap layout
    for (i = 0; i < 1000; i++) {
        spray_chunks[i] = kmalloc(64, GFP_KERNEL);
        if (!spray_chunks[i]) break;
        
        // Fill with controlled data
        memset(spray_chunks[i], 0x41, 64);
    }
    
    // Free every other chunk to create holes
    for (i = 0; i < 1000; i += 2) {
        if (spray_chunks[i]) {
            kfree(spray_chunks[i]);
            spray_chunks[i] = NULL;
        }
    }
}

// 3. Stack Pivoting
static void kernel_stack_pivot(void) {
    unsigned long new_stack;
    
    // Allocate new stack
    new_stack = (unsigned long)kmalloc(4096, GFP_KERNEL);
    if (!new_stack) return;
    
    // Set up new stack with controlled data
    unsigned long *stack_data = (unsigned long *)new_stack;
    stack_data[0] = 0xdeadbeef;
    stack_data[1] = 0xcafebabe;
    
    // In real exploit, this would pivot to new stack
    // asm volatile("mov %0, %%rsp" : : "r"(new_stack));
    
    kfree((void *)new_stack);
}

// 4. SMEP/SMAP Bypass
static void smep_smap_bypass(void) {
    // SMEP (Supervisor Mode Execution Prevention) bypass
    // Use ROP to disable SMEP in CR4 register
    
    unsigned long cr4_value;
    
    // Read current CR4
    asm volatile("mov %%cr4, %0" : "=r"(cr4_value));
    
    // Clear SMEP bit (bit 20)
    cr4_value &= ~(1UL << 20);
    
    // Write back CR4
    asm volatile("mov %0, %%cr4" : : "r"(cr4_value));
    
    // Now we can execute user space code from kernel
    // (This is a simplified example)
}

// 5. KASLR Bypass
static void kaslr_bypass(void) {
    // KASLR (Kernel Address Space Layout Randomization) bypass
    // Use information leaks to determine kernel base address
    
    unsigned long kernel_base = 0;
    
    // Method 1: Use /proc/kallsyms (if available)
    // Method 2: Use timing attacks
    // Method 3: Use side-channel attacks
    
    // For demonstration, we'll use a known offset
    kernel_base = 0xffffffff81000000; // Typical kernel base
    
    // Calculate target function address
    unsigned long target_func = kernel_base + 0x1000;
    
    // Use in exploit
    printk(KERN_INFO "Target function at: %lx\\n", target_func);
}`

  const privilegeEscalationCode = `// Privilege Escalation Techniques
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/cred.h>
#include <linux/sched.h>
#include <linux/uaccess.h>

// 1. Cred Structure Manipulation
static void escalate_privileges(void) {
    struct cred *new_cred;
    
    // Get current task
    struct task_struct *current_task = current;
    
    // Prepare new credentials
    new_cred = prepare_creds();
    if (!new_cred) return;
    
    // Set root privileges
    new_cred->uid.val = 0;
    new_cred->gid.val = 0;
    new_cred->suid.val = 0;
    new_cred->sgid.val = 0;
    new_cred->euid.val = 0;
    new_cred->egid.val = 0;
    new_cred->fsuid.val = 0;
    new_cred->fsgid.val = 0;
    
    // Set all capability sets
    cap_set_full(new_cred->cap_inheritable);
    cap_set_full(new_cred->cap_permitted);
    cap_set_full(new_cred->cap_effective);
    cap_set_full(new_cred->cap_bset);
    cap_set_full(new_cred->cap_ambient);
    
    // Commit new credentials
    commit_creds(new_cred);
}

// 2. Process Replacement
static int replace_process(void) {
    struct task_struct *current_task = current;
    struct cred *new_cred;
    
    // Get new credentials
    new_cred = prepare_creds();
    if (!new_cred) return -ENOMEM;
    
    // Set root privileges
    new_cred->uid.val = 0;
    new_cred->gid.val = 0;
    new_cred->euid.val = 0;
    new_cred->egid.val = 0;
    
    // Set capabilities
    cap_set_full(new_cred->cap_permitted);
    cap_set_full(new_cred->cap_effective);
    
    // Commit credentials
    commit_creds(new_cred);
    
    return 0;
}

// 3. Kernel Module Loading
static int load_malicious_module(void) {
    // This would typically be done through a vulnerability
    // that allows arbitrary kernel code execution
    
    // Example: Load a module that gives us persistent access
    char module_path[] = "/tmp/malicious_module.ko";
    
    // In real exploit, this would be done through syscalls
    // or direct kernel manipulation
    
    return 0;
}

// 4. Disable Security Features
static void disable_security_features(void) {
    unsigned long cr0_value, cr4_value;
    
    // Disable SMEP (Supervisor Mode Execution Prevention)
    asm volatile("mov %%cr4, %0" : "=r"(cr4_value));
    cr4_value &= ~(1UL << 20); // Clear SMEP bit
    asm volatile("mov %0, %%cr4" : : "r"(cr4_value));
    
    // Disable SMAP (Supervisor Mode Access Prevention)
    asm volatile("mov %%cr4, %0" : "=r"(cr4_value));
    cr4_value &= ~(1UL << 21); // Clear SMAP bit
    asm volatile("mov %0, %%cr4" : : "r"(cr4_value));
    
    // Disable write protection
    asm volatile("mov %%cr0, %0" : "=r"(cr0_value));
    cr0_value &= ~(1UL << 16); // Clear WP bit
    asm volatile("mov %0, %%cr0" : : "r"(cr0_value));
}

// 5. Persistence Mechanisms
static void establish_persistence(void) {
    // Method 1: Modify kernel image
    // Method 2: Install rootkit
    // Method 3: Modify system files
    // Method 4: Install backdoor
    
    // Example: Install a backdoor in kernel
    // This would typically involve modifying system calls
    // or installing a kernel module
    
    printk(KERN_INFO "Persistence established\\n");
}`

  const relatedPosts = [
    {
      title: "Building Evasive C2 Implants: Advanced Techniques",
      excerpt: "Comprehensive guide to creating undetectable command and control frameworks.",
      date: "Jan 10, 2025",
      readTime: "8 min",
      tags: ["C2", "Evasion", "Red Team"]
    },
    {
      title: "Active Directory Attack Paths: A Red Team Guide",
      excerpt: "Advanced techniques for lateral movement and privilege escalation in AD environments.",
      date: "Jan 15, 2025",
      readTime: "12 min",
      tags: ["Active Directory", "Red Team", "Lateral Movement"]
    },
    {
      title: "Advanced Persistence Techniques",
      excerpt: "Deep dive into sophisticated persistence mechanisms for red team operations.",
      date: "Dec 20, 2024",
      readTime: "10 min",
      tags: ["Persistence", "Red Team", "Evasion"]
    }
  ]

  return (
    <DetailPageLayout 
      title="Kernel Exploitation 101"
      subtitle="Understanding and Exploiting Kernel Vulnerabilities"
      breadcrumb={{ label: "Research", href: "/#research" }}
    >
      <div className="max-w-6xl mx-auto px-6 py-12">
        <div className="grid lg:grid-cols-4 gap-12">
          {/* Table of Contents - Sidebar */}
          <motion.div
            className="lg:col-span-1"
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.5 }}
          >
            <div className="sticky top-8">
              <h3 className="text-lg font-semibold text-white mb-4">Table of Contents</h3>
              <nav className="space-y-2">
                {tocSections.map((section) => (
                  <a
                    key={section.id}
                    href={`#${section.id}`}
                    className={`block text-sm py-2 px-3 rounded-md transition-colors ${
                      activeSection === section.id
                        ? 'bg-red-500/20 text-red-400 border border-red-500/30'
                        : 'text-gray-400 hover:text-white hover:bg-gray-800/30'
                    }`}
                  >
                    {section.title}
                  </a>
                ))}
              </nav>
            </div>
          </motion.div>

          {/* Main Content */}
          <div className="lg:col-span-3">
            {/* Back Button */}

            {/* Hero/Header */}
            <motion.header
              className="mb-12"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8 }}
            >
              <h1 className="text-4xl lg:text-5xl font-bold text-white mb-6 leading-tight">
                Kernel Exploitation 101: From Basics to Advanced Techniques
              </h1>
              
              <div className="flex flex-wrap items-center gap-4 text-sm text-gray-400 mb-6">
                <span>Jan 5, 2025</span>
                <span>‚Ä¢</span>
                <span>Darrius Grate</span>
                <span>‚Ä¢</span>
                <span>15 min read</span>
              </div>
              
              <div className="flex flex-wrap gap-2">
                {['Kernel', 'Exploitation', 'Privilege Escalation', 'ROP', 'Heap Spraying'].map((tag) => (
                  <span
                    key={tag}
                    className="px-3 py-1 bg-red-500/20 text-red-400 text-sm rounded-full border border-red-500/30"
                  >
                    {tag}
                  </span>
                ))}
              </div>
            </motion.header>

            {/* Introduction */}
            <motion.section
              id="introduction"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.2 }}
            >
              <h2 className="text-3xl font-bold text-white mb-6">Introduction</h2>
              <div className="prose prose-lg max-w-none">
                <p className="text-gray-300 leading-relaxed mb-6">
                  Kernel exploitation represents the pinnacle of system-level security research, 
                  requiring deep understanding of operating system internals, memory management, 
                  and low-level programming concepts. Unlike user-space exploitation, kernel 
                  exploits operate at the highest privilege level, making them both powerful 
                  and dangerous.
                </p>
                <p className="text-gray-300 leading-relaxed mb-6">
                  This comprehensive guide covers the fundamentals of kernel exploitation, 
                  from understanding the kernel space environment to advanced techniques like 
                  ROP (Return-Oriented Programming), heap spraying, and privilege escalation. 
                  We'll explore common vulnerability types, exploitation methodologies, and 
                  defensive measures.
                </p>
                <p className="text-gray-300 leading-relaxed">
                  <strong>What you'll learn:</strong> Kernel space fundamentals, common 
                  vulnerability types, exploitation techniques, privilege escalation methods, 
                  and defensive strategies for protecting against kernel-level attacks.
                </p>
              </div>
            </motion.section>

            {/* Kernel Basics */}
            <motion.section
              id="kernel-basics"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.3 }}
            >
              <h2 className="text-3xl font-bold text-white mb-6">Kernel Basics</h2>
              <div className="prose prose-lg max-w-none mb-8">
                <p className="text-gray-300 leading-relaxed mb-6">
                  The kernel is the core component of an operating system, responsible for 
                  managing system resources, hardware access, and providing services to 
                  user-space applications. Understanding the kernel's architecture and 
                  operation is essential for effective exploitation.
                </p>
                <p className="text-gray-300 leading-relaxed mb-6">
                  Key concepts include the separation between kernel space and user space, 
                  memory management, system calls, and the kernel's privileged access to 
                  hardware and system resources.
                </p>
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Kernel Space Fundamentals</h3>
                <CodeBlock
                  code={kernelBasicsCode}
                  language="c"
                  title="Kernel Space vs User Space"
                />
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Key Concepts</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">Kernel Space</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Direct hardware access</li>
                      <li>‚Ä¢ No memory protection</li>
                      <li>‚Ä¢ Privileged operations</li>
                      <li>‚Ä¢ System call handling</li>
                    </ul>
                  </div>
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">User Space</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Memory protection</li>
                      <li>‚Ä¢ Limited system access</li>
                      <li>‚Ä¢ System call interface</li>
                      <li>‚Ä¢ Application execution</li>
                    </ul>
                  </div>
                </div>
              </div>
            </motion.section>

            {/* Vulnerability Types */}
            <motion.section
              id="vulnerability-types"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.4 }}
            >
              <h2 className="text-3xl font-bold text-white mb-6">Vulnerability Types</h2>
              <div className="prose prose-lg max-w-none mb-8">
                <p className="text-gray-300 leading-relaxed mb-6">
                  Kernel vulnerabilities can take many forms, each with its own exploitation 
                  characteristics and potential impact. Understanding these vulnerability 
                  types is crucial for both offensive and defensive security professionals.
                </p>
                <p className="text-gray-300 leading-relaxed mb-6">
                  Common kernel vulnerability types include buffer overflows, use-after-free 
                  bugs, integer overflows, race conditions, and double-free vulnerabilities. 
                  Each type requires specific exploitation techniques and defensive measures.
                </p>
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Common Vulnerability Patterns</h3>
                <CodeBlock
                  code={vulnerabilityTypesCode}
                  language="c"
                  title="Kernel Vulnerability Examples"
                />
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Vulnerability Impact</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">High Impact</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Privilege escalation</li>
                      <li>‚Ä¢ Arbitrary code execution</li>
                      <li>‚Ä¢ System compromise</li>
                      <li>‚Ä¢ Persistent access</li>
                    </ul>
                  </div>
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">Exploitation Complexity</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Requires deep OS knowledge</li>
                      <li>‚Ä¢ Platform-specific techniques</li>
                      <li>‚Ä¢ Complex exploit development</li>
                      <li>‚Ä¢ High skill requirement</li>
                    </ul>
                  </div>
                </div>
              </div>
            </motion.section>

            {/* Exploitation Techniques */}
            <motion.section
              id="exploitation-techniques"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.5 }}
            >
              <h2 className="text-3xl font-bold text-white mb-6">Exploitation Techniques</h2>
              <div className="prose prose-lg max-w-none mb-8">
                <p className="text-gray-300 leading-relaxed mb-6">
                  Kernel exploitation techniques have evolved significantly over the years, 
                  with modern exploits employing sophisticated methods to bypass security 
                  mitigations and achieve reliable code execution.
                </p>
                <p className="text-gray-300 leading-relaxed mb-6">
                  Advanced techniques include ROP (Return-Oriented Programming), heap 
                  spraying, stack pivoting, and various bypasses for modern security 
                  features like SMEP, SMAP, and KASLR.
                </p>
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Advanced Exploitation Methods</h3>
                <CodeBlock
                  code={exploitationTechniquesCode}
                  language="c"
                  title="Kernel Exploitation Techniques"
                />
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Security Mitigation Bypasses</h3>
                <Callout type="warning" title="Modern Security Features">
                  Modern kernels implement various security features to prevent exploitation. 
                  Understanding these mitigations is crucial for developing effective exploits 
                  and defensive measures.
                </Callout>
                <div className="grid md:grid-cols-2 gap-6 mt-6">
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">Hardware Mitigations</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ SMEP (Supervisor Mode Execution Prevention)</li>
                      <li>‚Ä¢ SMAP (Supervisor Mode Access Prevention)</li>
                      <li>‚Ä¢ Intel CET (Control-flow Enforcement Technology)</li>
                      <li>‚Ä¢ ARM Pointer Authentication</li>
                    </ul>
                  </div>
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">Software Mitigations</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ KASLR (Kernel Address Space Layout Randomization)</li>
                      <li>‚Ä¢ Stack canaries</li>
                      <li>‚Ä¢ Heap hardening</li>
                      <li>‚Ä¢ Control Flow Integrity (CFI)</li>
                    </ul>
                  </div>
                </div>
              </div>
            </motion.section>

            {/* Privilege Escalation */}
            <motion.section
              id="privilege-escalation"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.6 }}
            >
              <h2 className="text-3xl font-bold text-white mb-6">Privilege Escalation</h2>
              <div className="prose prose-lg max-w-none mb-8">
                <p className="text-gray-300 leading-relaxed mb-6">
                  The ultimate goal of most kernel exploits is privilege escalation, 
                  gaining root or system-level access to the target system. This section 
                  covers various techniques for achieving and maintaining elevated privileges.
                </p>
                <p className="text-gray-300 leading-relaxed mb-6">
                  Privilege escalation techniques include credential manipulation, process 
                  replacement, kernel module loading, and establishing persistence mechanisms 
                  to maintain access after the initial compromise.
                </p>
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Privilege Escalation Methods</h3>
                <CodeBlock
                  code={privilegeEscalationCode}
                  language="c"
                  title="Privilege Escalation Techniques"
                />
              </div>

              <div className="mb-8">
                <h3 className="text-xl font-semibold text-white mb-4">Persistence Mechanisms</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">Kernel-Level Persistence</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Kernel module installation</li>
                      <li>‚Ä¢ System call hooking</li>
                      <li>‚Ä¢ Kernel image modification</li>
                      <li>‚Ä¢ Bootkit installation</li>
                    </ul>
                  </div>
                  <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                    <h4 className="text-lg font-semibold text-white mb-3">Detection Challenges</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Deep system integration</li>
                      <li>‚Ä¢ Bypass of security tools</li>
                      <li>‚Ä¢ Difficult to detect</li>
                      <li>‚Ä¢ Requires specialized tools</li>
                    </ul>
                  </div>
                </div>
              </div>
            </motion.section>

            {/* Defensive Measures */}
            <motion.section
              id="defensive-measures"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.7 }}
            >
              <h2 className="text-3xl font-bold text-white mb-8">Defensive Measures</h2>
              
              <div className="grid md:grid-cols-2 gap-8 mb-8">
                <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                  <h3 className="text-xl font-semibold text-white mb-4">Prevention Strategies</h3>
                  <ul className="text-gray-300 space-y-3">
                    <li>‚Ä¢ <strong>Kernel Hardening:</strong> Enable all available security features</li>
                    <li>‚Ä¢ <strong>Regular Updates:</strong> Keep kernel and drivers updated</li>
                    <li>‚Ä¢ <strong>Code Review:</strong> Implement thorough code review processes</li>
                    <li>‚Ä¢ <strong>Static Analysis:</strong> Use automated vulnerability detection</li>
                  </ul>
                </div>
                
                <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                  <h3 className="text-xl font-semibold text-white mb-4">Detection Methods</h3>
                  <ul className="text-gray-300 space-y-3">
                    <li>‚Ä¢ <strong>Kernel Monitoring:</strong> Monitor kernel behavior and integrity</li>
                    <li>‚Ä¢ <strong>Memory Analysis:</strong> Regular memory integrity checks</li>
                    <li>‚Ä¢ <strong>System Call Monitoring:</strong> Track unusual system call patterns</li>
                    <li>‚Ä¢ <strong>Forensic Analysis:</strong> Post-incident kernel analysis</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6">
                <h3 className="text-xl font-semibold text-white mb-4">Best Practices</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <h4 className="text-lg font-semibold text-white mb-3">Development</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Use secure coding practices</li>
                      <li>‚Ä¢ Implement proper bounds checking</li>
                      <li>‚Ä¢ Use safe memory management</li>
                      <li>‚Ä¢ Regular security testing</li>
                      <li>‚Ä¢ Code review processes</li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="text-lg font-semibold text-white mb-3">Deployment</h4>
                    <ul className="text-gray-300 space-y-2 text-sm">
                      <li>‚Ä¢ Enable all security features</li>
                      <li>‚Ä¢ Implement monitoring</li>
                      <li>‚Ä¢ Regular security updates</li>
                      <li>‚Ä¢ Incident response procedures</li>
                      <li>‚Ä¢ Forensic capabilities</li>
                    </ul>
                  </div>
                </div>
              </div>
            </motion.section>

            {/* Key Takeaways */}
            <motion.section
              id="key-takeaways"
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.8 }}
            >
              <h2 className="text-3xl font-bold text-white mb-8">Key Takeaways</h2>
              
              <Callout type="success" title="Action Items for Defenders">
                <ul className="space-y-2">
                  <li>‚Ä¢ <strong>Enable all kernel security features</strong> including SMEP, SMAP, and KASLR</li>
                  <li>‚Ä¢ <strong>Implement comprehensive monitoring</strong> for kernel-level activities</li>
                  <li>‚Ä¢ <strong>Regular security updates</strong> to patch known vulnerabilities</li>
                  <li>‚Ä¢ <strong>Code review processes</strong> for kernel and driver development</li>
                  <li>‚Ä¢ <strong>Incident response procedures</strong> for kernel-level compromises</li>
                </ul>
              </Callout>

              <div className="mt-8">
                <h3 className="text-xl font-semibold text-white mb-4">Summary</h3>
                <p className="text-gray-300 leading-relaxed">
                  Kernel exploitation represents one of the most sophisticated areas of 
                  cybersecurity, requiring deep understanding of operating system internals 
                  and advanced programming techniques. While kernel exploits can be highly 
                  effective, they also require significant skill and knowledge to develop 
                  and execute successfully. Defenders must understand these techniques to 
                  implement effective countermeasures and protect their systems from 
                  kernel-level attacks.
                </p>
              </div>
            </motion.section>

            {/* Related Content */}
            <motion.section
              className="mb-16"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.9 }}
            >
              <h2 className="text-3xl font-bold text-white mb-8">Continue Reading</h2>
              <div className="grid md:grid-cols-3 gap-6">
                {relatedPosts.map((post, index) => (
                  <motion.div
                    key={post.title}
                    className="bg-gray-800/30 rounded-lg border border-gray-700/50 backdrop-blur-sm p-6 hover:border-red-500/30 transition-colors"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.6, delay: 1.0 + index * 0.1 }}
                    whileHover={{ scale: 1.02 }}
                  >
                    <h3 className="text-lg font-semibold text-white mb-3 hover:text-red-400 transition-colors">
                      {post.title}
                    </h3>
                    <p className="text-gray-300 text-sm leading-relaxed mb-4">
                      {post.excerpt}
                    </p>
                    <div className="flex items-center justify-between text-xs text-gray-400">
                      <span>{post.date}</span>
                      <span>{post.readTime}</span>
                    </div>
                    <div className="flex flex-wrap gap-1 mt-3">
                      {post.tags.map((tag) => (
                        <span
                          key={tag}
                          className="px-2 py-1 bg-gray-700/50 text-gray-300 text-xs rounded"
                        >
                          {tag}
                        </span>
                      ))}
                    </div>
                  </motion.div>
                ))}
              </div>
            </motion.section>

            {/* Footer */}
            <motion.div
              className="border-t border-gray-700/50 pt-8"
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 1.0 }}
            >
              <div className="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
                <div className="flex items-center space-x-6">
                  <button className="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors">
                    <span className="text-xl">üê¶</span>
                    <span>Share on Twitter</span>
                  </button>
                  <button className="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors">
                    <span className="text-xl">üíº</span>
                    <span>Share on LinkedIn</span>
                  </button>
                  <button className="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors">
                    <span className="text-xl">üìã</span>
                    <span>Copy Link</span>
                  </button>
                </div>
                
                <div className="flex items-center space-x-4">
                  <div className="w-12 h-12 bg-red-500/20 rounded-full border border-red-500/30 flex items-center justify-center">
                    <span className="text-xl">üë®‚Äçüíª</span>
                  </div>
                  <div>
                    <h4 className="text-sm font-semibold text-white">Darrius Grate</h4>
                    <p className="text-xs text-gray-400">Red Team Security Researcher</p>
                  </div>
                </div>
              </div>
            </motion.div>
          </div>
        </div>
      </div>
    </DetailPageLayout>
  )
}
